db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-01', checkinDate: '2016-06-16', metric: 'avgRank', value: 15})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-02', checkinDate: '2016-06-16', metric: 'avgRank', value: 14})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-03', checkinDate: '2016-06-16', metric: 'avgRank', value: 13})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-04', checkinDate: '2016-06-16', metric: 'avgRank', value: 14})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-05', checkinDate: '2016-06-16', metric: 'avgRank', value: 15})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-06', checkinDate: '2016-06-16', metric: 'avgRank', value: 15})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-07', checkinDate: '2016-06-16', metric: 'avgRank', value: 14})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-08', checkinDate: '2016-06-16', metric: 'avgRank', value: 12})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-09', checkinDate: '2016-06-16', metric: 'avgRank', value: 13})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-10', checkinDate: '2016-06-16', metric: 'avgRank', value: 16})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-11', checkinDate: '2016-06-16', metric: 'avgRank', value: 17})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-12', checkinDate: '2016-06-16', metric: 'avgRank', value: 18})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-13', checkinDate: '2016-06-16', metric: 'avgRank', value: 14})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-14', checkinDate: '2016-06-16', metric: 'avgRank', value: 15})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-15', checkinDate: '2016-06-16', metric: 'avgRank', value: 13})

db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-01', checkinDate: '2016-06-16', metric: 'avgPrice', value: 100.00})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-02', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.99})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-03', checkinDate: '2016-06-16', metric: 'avgPrice', value: 101.01})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-04', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-05', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.07})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-06', checkinDate: '2016-06-16', metric: 'avgPrice', value: 100.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-07', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-08', checkinDate: '2016-06-16', metric: 'avgPrice', value: 100.01})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-09', checkinDate: '2016-06-16', metric: 'avgPrice', value: 100.01})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-10', checkinDate: '2016-06-16', metric: 'avgPrice', value: 100.00})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-11', checkinDate: '2016-06-16', metric: 'avgPrice', value: 101.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-12', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.00})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-13', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-14', checkinDate: '2016-06-16', metric: 'avgPrice', value: 100.01})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-15', checkinDate: '2016-06-16', metric: 'avgPrice', value: 100.01})

db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-01', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.00})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-02', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.99})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-03', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.01})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-04', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-05', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.07})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-06', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-07', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-08', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.01})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-09', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.01})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-10', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.00})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-11', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-12', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.00})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-13', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.09})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-14', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.01})
db.timeseries.insert({hotelId: 15240008, tpid:1, regionId: 2872, searchDate: '2016-06-15', checkinDate: '2016-06-16', metric: 'avgComp', value: 30.01})



db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-01', checkinDate: '2016-06-16', metric: 'avgRank', value: 17})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-02', checkinDate: '2016-06-16', metric: 'avgRank', value: 18})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-03', checkinDate: '2016-06-16', metric: 'avgRank', value: 19})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-04', checkinDate: '2016-06-16', metric: 'avgRank', value: 17})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-05', checkinDate: '2016-06-16', metric: 'avgRank', value: 18})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-06', checkinDate: '2016-06-16', metric: 'avgRank', value: 19})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-07', checkinDate: '2016-06-16', metric: 'avgRank', value: 17})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-08', checkinDate: '2016-06-16', metric: 'avgRank', value: 18})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-09', checkinDate: '2016-06-16', metric: 'avgRank', value: 19})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-10', checkinDate: '2016-06-16', metric: 'avgRank', value: 17})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-11', checkinDate: '2016-06-16', metric: 'avgRank', value: 18})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-12', checkinDate: '2016-06-16', metric: 'avgRank', value: 19})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-13', checkinDate: '2016-06-16', metric: 'avgRank', value: 17})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-14', checkinDate: '2016-06-16', metric: 'avgRank', value: 18})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-15', checkinDate: '2016-06-16', metric: 'avgRank', value: 19})

db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-01', checkinDate: '2016-06-16', metric: 'avgPrice', value: 110.00})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-02', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.99})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-03', checkinDate: '2016-06-16', metric: 'avgPrice', value: 111.01})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-04', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-05', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.07})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-06', checkinDate: '2016-06-16', metric: 'avgPrice', value: 120.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-07', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-08', checkinDate: '2016-06-16', metric: 'avgPrice', value: 110.01})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-09', checkinDate: '2016-06-16', metric: 'avgPrice', value: 120.01})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-10', checkinDate: '2016-06-16', metric: 'avgPrice', value: 110.00})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-11', checkinDate: '2016-06-16', metric: 'avgPrice', value: 121.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-12', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.00})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-13', checkinDate: '2016-06-16', metric: 'avgPrice', value: 99.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-14', checkinDate: '2016-06-16', metric: 'avgPrice', value: 110.01})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-15', checkinDate: '2016-06-16', metric: 'avgPrice', value: 120.01})

db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-01', checkinDate: '2016-06-16', metric: 'avgComp', value: 36.00})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-02', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.99})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-03', checkinDate: '2016-06-16', metric: 'avgComp', value: 35.01})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-04', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-05', checkinDate: '2016-06-16', metric: 'avgComp', value: 36.07})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-06', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-07', checkinDate: '2016-06-16', metric: 'avgComp', value: 35.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-08', checkinDate: '2016-06-16', metric: 'avgComp', value: 36.01})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-09', checkinDate: '2016-06-16', metric: 'avgComp', value: 35.01})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-10', checkinDate: '2016-06-16', metric: 'avgComp', value: 36.00})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-11', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-12', checkinDate: '2016-06-16', metric: 'avgComp', value: 36.00})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-13', checkinDate: '2016-06-16', metric: 'avgComp', value: 31.09})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-14', checkinDate: '2016-06-16', metric: 'avgComp', value: 36.01})
db.timeseries.insert({hotelId: 15240008, tpid:3, regionId: 2872, searchDate: '2016-06-15', checkinDate: '2016-06-16', metric: 'avgComp', value: 37.01})





db.timeseries.createIndex({hotelId: 1, tpid: 1, regionId: 1})


// totals by region id 
db.timeseries.aggregate([ { $group: { _id: "$regionId", total: {$sum: 1} } } ])


// average average price per POS (all period)
db.timeseries.aggregate( [ { $match : { metric : "avgPrice" } }, { $group: { _id: "$tpid", avgAvgPrice: { $avg: "$value" } } } ] )
db.timeseries.aggregate( [ { $match : { metric : "avgPrice" } }, { $group: { _id: "$tpid", minAvgPrice: { $min: "$value" } } } ] )
db.timeseries.aggregate( [ { $match : { metric : "avgPrice" } }, { $group: { _id: "$tpid", maxAvgPrice: { $max: "$value" } } } ] )
db.timeseries.aggregate( [ { $match : { metric : "avgPrice" } }, { $group: { _id: "$tpid", stdevAvgPrice: { $stdDevSamp: "$value" } } } ] )



db.timeseries.find({"$and": [ {"tpid":1}, {"regionId": 2872}, {"hotelId": 15240008} ]}, {"_id":0, "searchDate":1, "metric":1, "value":1} ).sort({"searchDate":1})


db.timeseries.aggregate([
    { "$match" : { "tpid": 1, "regionId": 2872, "hotelId": 15240008} },
    { "$group" : { "_id": "$searchDate", "metric": "$metric", "value": "$value" } }
])




db.timeseries.aggregate([
    { "$match" : { "tpid": 1, "regionId": 2872, "hotelId": 15240008} },
    { "$group" : { "_id": "$searchDate", "metrics": { "$push": "$metric" }, "values": { "$push": "$value" } } },
    { "$project" : { "searchDate": "$_id", "metrics": 1, "values": 1, "_id": 0 } }
]).sort( {"searchDate": 1} )